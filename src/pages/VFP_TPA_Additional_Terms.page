<apex:page controller="CNT_TPA_Additional_Terms" sidebar="false" cache="false" title="TPA Ad-hoc Additional Terms" id="pg" standardStylesheets="false" lightningStyleSheets="true" >
    <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" lang="en">
        <head>
            <meta http-equiv="X-UA-Compatible" content="IE=9" />
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />

            <!-- stylesheet for new style tab -->
            <apex:stylesheet value="/sCSS/21.0/sprites/1297816277000/Theme3/default/gc/versioning.css" />

            <!-- *** Angular-JS Library reference ** -->
            <apex:includeScript value="{!$Resource.AngularJS}" />
            <!-- *** Angular-JS Library reference ** -->

            <!-- *** Angular-JS Bootstrap Modal Pop Up Library reference ** -->
            <script src="{!$Resource.AngularUiBootstrap}" type="text/javascript"></script>
            <!-- *** Angular-JS Bootstrap Modal Pop Up Library reference ** -->

            <!-- *** Library reference to fill controlling and dependent picklist from api by making client side call *** -->
            <script src="/soap/ajax/52.0/connection.js" type="text/javascript"></script>
            <script src="/soap/ajax/52.0/apex.js" type="text/javascript"></script>
            <script src="../static/102010/js/picklist.js"></script>
            <!-- *** Library reference to fill controlling and dependent picklist from api by making client side call *** -->

            <!-- *** Jquery library reference *** -->
            <script src="{!$Resource.TPAJquery}" type="text/javascript"></script>
            <!-- *** Jquery library reference *** -->

            <!-- *** JQuery UI Library reference *** -->
            <script src="{!$Resource.TPAJqueryUI}" type="text/javascript"></script>
            <!-- *** JQuery UI Library reference *** -->

            <!-- *** JQuery Custom Popup Library reference *** -->
            <script src="{!URLFOR($Resource.TpaCustomPopup, 'popup.js')}" type="text/javascript"></script>
            <!-- *** JQuery Custom Popup Library reference *** -->

            <!-- *** JQuery Custom Popup Stylesheet reference *** -->
            <link href="{!URLFOR($Resource.TpaCustomPopup, 'popup.css')}" rel="stylesheet" />
            <!-- *** JQuery Custom Popup Stylesheet reference *** -->

            <!-- *** JQuery UI Stylesheet reference *** -->
            <link href="{!URLFOR($Resource.TPAJqueryUICss)}" rel="stylesheet" />
            <!-- *** JQuery UI Stylesheet reference *** -->

            <!-- *** Bootstrap Javascript Library reference *** -->
            <script src="{!$Resource.BootstrapJS}" type="text/javascript"></script>
            <!-- *** Bootstrap Javascript Library reference *** -->

            <!-- *** Yahoo Javascript Library reference *** -->
            <apex:includeScript value="{!URLFOR($Resource.YUILibrary2, '/yui/build/yahoo-dom-event/yahoo-dom-event.js')}" />
            <apex:includeScript value="{!URLFOR($Resource.YUILibrary2, '/yui/build/container/container-min.js')}" />
            <apex:includescript value="{!URLFOR($Resource.YUILibrary2, '/yui/build/dragdrop/dragdrop-min.js')}" />
            <apex:includescript value="{!URLFOR($Resource.YUILibrary2, '/yui/build/animation/animation-min.js')}" />
            <apex:includeScript value="{!URLFOR($Resource.YUILibrary2, '/yui/build/treeview/treeview-min.js')}" />
            <apex:includeScript value="{!URLFOR($Resource.YUILibrary2, '/yui/build/menu/menu-min.js')}" />
            <apex:includeScript value="{!URLFOR($Resource.YUILibrary2, '/yui/build/yahoo/yahoo-min.js')}" />
            <!-- *** Yahoo Javascript Library reference *** -->

            <!-- *** Yahoo Css Library reference *** -->
            <apex:stylesheet value="{!URLFOR($Resource.YUILibrary2, '/yui/build/assets/skins/sam/skin.css')}" />
            <apex:stylesheet value="{!URLFOR($Resource.YUILibrary2, '/yui/build/treeview/assets/skins/sam/treeview.css')}" />
            <apex:stylesheet value="{!URLFOR($Resource.YUILibrary2, '/yui/examples/treeview/assets/css/menu/tree.css')}" />
            <apex:stylesheet value="{!URLFOR($Resource.YUILibrary2, '/yui/build/menu/assets/skins/sam/menu.css')}" />
            <apex:stylesheet value="{!URLFOR($Resource.YUILibrary2, '/yui/build/container/assets/skins/sam/container.css')}" />
            <!-- *** Yahoo Css Library reference *** -->

            <!-- *** Multi Select Control CSS reference *** -->
            <link href="{!URLFOR($Resource.TpaMultiSelect, 'select2.css')}" rel="stylesheet" />
            <!-- *** Multi Select Control CSS reference *** -->

            <!-- *** Multi Select Control Javascript Library reference *** -->
            <script src="{!URLFOR($Resource.TpaMultiSelect, 'select2.js')}" type="text/javascript"></script>
            <!--  Multi Select Control Javascript Library reference  -->

            <style type="text/css">
                .detailList table  {
                    table-layout: auto !important;
                }
            .dataCellAdd{
                max-width: 40vw;
                min-width: 10vw; 
                }
            .dataCell{
                max-width: 10vw;
                min-width: 7vw;
                }
           
            </style>
            
            <!-- ****** AngularJS script Start ****** -->
            <script type="text/javascript">
                //*** Wait Panel Start ***//
                // Create a namespace for our custom functions
                YAHOO.namespace("force.com");
                
                /**
                 * Builds the wait panel.
                 */
                YAHOO.force.com.buildWaitPanel = function() 
                {
                    document.body.className = document.body.className + " yui-skin-sam";
                    YAHOO.force.com.waitPanel = new YAHOO.widget.Panel(
                        "waitPanel",  // The id of our dialog container
                        { 
                            width           :   "300px", // You can play with this until it is right
                            visible         :   false,   // Should be invisible when rendered
                            draggable       :   false,   // Make the dialog draggable
                            close           :   false,   // Do not include a close title button
                            modal           :   true,    // Make it modal
                            fixedCenter     :   true,    // Keep centered if window is scrolled
                            zindex          :   40,      // Make sure it is on top of everything
                            constraintoviewport: true,
                            
                            // This line adds the appear/disapper fade effect
                            effect          :   {effect:YAHOO.widget.ContainerEffect.FADE,duration:0.25}
                        });
                
                    // header
                    YAHOO.force.com.waitPanel.setHeader("{!$Label.TPA_Please_wait}");// text updated by sumita  dabas issue 5222 27 august 2014,Modified by Govind under ER-1940
                    // set image
                    YAHOO.force.com.waitPanel.setBody('<center><img src="{!URLFOR($Resource.Image_LoadingPage)}" /></center>');
                    // Render the dialog to the document.body level of the DOM
                    YAHOO.force.com.waitPanel.render(document.body);
                }
                
                /**
                 * Callback when the action button is clicked
                 */
                function onActionClick() 
                {
                    // show the modal panel
                    if(YAHOO.force.com.waitPanel != null)
                        YAHOO.force.com.waitPanel.show();
                    // return false to allow the action to proceed
                    return false;
                }
            
                /**
                 * Callback when the action is completed
                 */
                function onActionComplete() 
                {
                    // hide the modal panel
                    //hideRequiredInput();
                    if(YAHOO.force.com.waitPanel != null)
                        YAHOO.force.com.waitPanel.hide();
                    window.scrollTo(0,0);
                }
            
                YAHOO.force.com.onDOMReady = function() 
                {
                    // add our custom skin css to the body tag
                    document.body.className = document.body.className + " yui-skin-sam";  
                    
                    // build the wait panel
                    YAHOO.force.com.buildWaitPanel();
                }
                
	            function helpTextShow(){
	                var helpText = document.getElementById('helpText');
	                helpText.style.display = 'block';
	            }
	            
	            function helpTextHide(){
	                var helpText = document.getElementById('helpText');
	                helpText.style.display = 'none';
                }
            
                // build the tree as soon as the DOM is in a usable state
                YAHOO.util.Event.onDOMReady(YAHOO.force.com.onDOMReady); 
                //*** Wait Panel End ***//
                
                var myapp = angular.module('AdditionalTermsApp', ['ui.bootstrap']);
                var contrl = myapp.controller('controllerPage', ['$scope', '$filter', '$modal', '$log', '$window', function($scope, $filter, $modal, $log, $window) { 
                    <!-- Initialize Services -->
                    $scope.$log = $log;
                    <!-- Initialize Services -->
                    
                    $scope.existingAdditionalTermsMap = {!JSONAdditionalTermsMap};
                    $scope.existingAttachIdMap = {!JSONAdditionalTermsAttachId};
                    
                    $scope.$log.info('$scope.existingAdditionalTermsMap = ' + JSON.stringify($scope.existingAdditionalTermsMap));
                    
                    $scope.categoryOptionsList = {!Category};    
                    $scope.$log.info('categoryOptionsList = ' + $scope.categoryOptionsList);  
                    
                    $scope.countriesList = [{
                        'useName' : '--None--',
                        'country' : '--None--'
                    }];
                    
                    //List of all selected primary offerings Data
                    $scope.priOfferingsList = {!jsonPriOfferingList};
                    $scope.$log.info('jsonPriOfferingList = ' + JSON.stringify({!jsonPriOfferingList}));
                    $scope.priOfferingsList.splice(0, 0, {Asset_Name__c: '--None--'});

                    $scope.usesList = [{
                        'useName' : '--None--',
                        'country' : '--None--',
                        'imsLegalEntity' : '--None--'
                    }];
                    $scope.usesUniqueList = [{
                        'useName' : '--None--',
                        'country' : '--None--',
                        'imsLegalEntity' : '--None--'
                    }];
                    $scope.usesCountryList = [{
                        'useName' : '--None--',
                        'country' : '--None--',
                        'imsLegalEntity' : '--None--'
                    }];
                    $scope.uniqueUseCountryCombinations = {};
                    $scope.uniqueUseCombinations = {};
                    $scope.uniqueCountriesList = {};
                    $scope.uniqueCountriesListString = '--None--';
                    $scope.uniqueUseCountriesListString = '--None--';
                    $scope.uniqueUsesString = '--None--';
                    $.each($scope.priOfferingsList, function(k,v) {
                        var imsLegalEntity = '';
                        if(v.TPA_Secondary_Data_Assets__r != null) {
                            $.each(v.TPA_Secondary_Data_Assets__r.records , function(k1, v1) {   
                                if(v1.IMS_Legal_Entity__c != null){
                                    imsLegalEntity = v1.IMS_Legal_Entity__c;
                                }
                            });
                        }
                        else if(v.IMSLegalEntity__c != null){
                            imsLegalEntity = v.IMSLegalEntity__c;
                        }
                        if($scope.usesList[v.A_Column_Use_For_Template__c] == null){
                            let useEntry = {
                                'useName' : v.A_Column_Use_For_Template__c,
                                'country' : v.BU__c,
                                'imsLegalEntity' : imsLegalEntity
                            };
                            if(v.A_Column_Use_For_Template__c != null && $scope.uniqueUseCombinations[v.A_Column_Use_For_Template__c] == null){
                                $scope.usesList.push(useEntry); 
                                $scope.uniqueUseCombinations[v.A_Column_Use_For_Template__c] = v.A_Column_Use_For_Template__c + v.BU__c;
                                $scope.uniqueUsesString = $scope.uniqueUsesString + ':' + v.A_Column_Use_For_Template__c;
                            }
                            if(v.A_Column_Use_For_Template__c != null && v.BU__c != null && $scope.uniqueUseCountryCombinations[v.A_Column_Use_For_Template__c + v.BU__c] == null){
                                $scope.$log.info('useEntry : ' + JSON.stringify(useEntry));
                                $scope.usesCountryList.push(useEntry); 
                                $scope.usesUniqueList.push(useEntry); 
                                $scope.uniqueUseCountryCombinations[v.A_Column_Use_For_Template__c + v.BU__c] = v.A_Column_Use_For_Template__c + v.BU__c;
                            }
                        }
                        if($scope.uniqueCountriesList[v.BU__c] == null && v.BU__c != null && v.BU__c != undefined){
                            let useCountryEntry = {
                                'useName' : v.A_Column_Use_For_Template__c,
                                'country' : v.BU__c
                            };
                            $scope.countriesList.push(useCountryEntry);
                            $scope.uniqueCountriesList[v.BU__c] = v.BU__c;
                            $scope.uniqueUseCountriesListString = $scope.uniqueUseCountriesListString + ':' + v.A_Column_Use_For_Template__c;
                            $scope.uniqueCountriesListString = $scope.uniqueCountriesListString +':' + v.BU__c ;
                        }
                        if(v.TPA_Secondary_Data_Assets__r != null && v.TPA_Secondary_Data_Assets__r.records != null && v.TPA_Secondary_Data_Assets__r.records.length > 0 ) {
                            v.TPA_Secondary_Data_Assets__r.records.splice(0, 0, {'Secondary_Asset_Name__c': '--None--'});
                        }
                    });

                    

                    $scope.isGlobalUser = {!isGlobalUser};

                    $scope.exhibitPageDoc = {};
                    $scope.additionalTermObj = {};
                    console.log($scope.usesCountryList);
                    $scope.additionalTermObj.countryOfOffering = $scope.usesCountryList[0];
                    $scope.additionalTermObj.selectedUse = $scope.usesUniqueList[0];
                    $scope.additionalTermObj.selectedPriOffering = $scope.priOfferingsList[0];
                    $scope.additionalTermObj.selectedCategory = $scope.categoryOptionsList[0];
                    $scope.$log.info('$scope.additionalTermObj.selectedCategory = ' + $scope.additionalTermObj.selectedCategory);
                    $scope.additionalTermObj.tpaRequest = {!tparequest};
                    $scope.additionalTermObj.doNotApply = false;
                    $scope.prevExhibitAttached = false;
                    $scope.$log.info('tparequest = ' + JSON.stringify($scope.additionalTermObj.tpaRequest));
                    
                    $scope.saveType = '';
                    
                    $scope.additionalTermSaveObj = {};
                    $scope.additionalTermSaveObj.Id = '';
                    
                    
                    
                    $scope.filterUses = function(){
                        $scope.filterUsesDuplicate = {};
                        return function(data){
                            if((data.useName == '--None--') || ($scope.filterUsesDuplicate[data.useName] == null && data.useName != '' && data.useName != null  && $scope.uniqueUsesString.indexOf(data.useName) != -1)){
                                $scope.filterUsesDuplicate[data.useName] = data.useName;
                                return true;
                            }
                            return false;
                        }
                    }
                    
                    $scope.filterCountries = function(){
                        $scope.filterCountriesDuplicate = {};
                        return function(data){
                            if($scope.additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term' && ((data.country == '--None--') || ($scope.filterCountriesDuplicate[data.country] == null && data.country != '' && data.country != null  && $scope.uniqueCountriesListString.indexOf(data.country) != -1))){
                                $scope.filterCountriesDuplicate[data.country] = data.country;
                                return true;
                            }
                            if($scope.additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms' && ((data.country == '--None--') || ($scope.filterCountriesDuplicate[data.country] == null && data.country != '' && data.country != null  && $scope.additionalTermObj.selectedUse.useName == data.useName && $scope.uniqueCountriesListString.indexOf(data.country) != -1))){
                                $scope.filterCountriesDuplicate[data.country] = data.country;
                                return true;
                            }
                            return false;
                        }
                    }
                    
                    //Filter all secondary offerings that come under selected primary offering
                    $scope.filterByPriOfferings = function() {
                        return function(data) {
                            if( $scope.additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term' && (data.Asset_Name__c == '--None--' || data.BU__c == $scope.additionalTermObj.countryOfOffering.country)) {
                                return true;
                            }
                            if($scope.additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms' && ((data.Asset_Name__c == '--None--') || (data.BU__c == $scope.additionalTermObj.countryOfOffering.country && data.A_Column_Use_For_Template__c == $scope.additionalTermObj.selectedUse.useName))) {
                                return true;
                            }
                            return false;
                        }
                    }
                    
                    $scope.categoryOptionUpdate = function(){
                        $scope.additionalTermObj.countryOfOffering = $scope.usesCountryList != null ? $scope.usesCountryList[0] : '';
                        $scope.additionalTermObj.selectedUse = $scope.usesUniqueList != null ? $scope.usesUniqueList[0] : '';
                        $scope.additionalTermObj.selectedPriOffering = $scope.priOfferingsList != null ? $scope.priOfferingsList[0] : '';
                    }
                    
                    $scope.dateFormatter = function(date) {
                        var dateValue = '';
                        if(date != null) {
                            $scope.lstDate = new Date(date);
                            dateValue = $scope.lstDate.getMonth()+1+'/'+$scope.lstDate.getDate()+'/'+$scope.lstDate.getFullYear();
                        }
                        return dateValue;
                    }
                                                                 
                    $scope.parseHTML = function(value) {
                        var t = document.createElement('div');
                        var doc = new DOMParser().parseFromString(value, "text/html");
                        t.innerHTML = doc.documentElement.textContent;
                        return t.innerText.replace(/<[^>]+>/g, '');
                    }
                    $scope.SaveReuest = function() {
                        $scope.$log.info('$scope.additionalTermObj = ' + JSON.stringify($scope.additionalTermObj));
                        if(!$scope.validateForm()) {
                            return false;
                        }
                        if($scope.saveType != 'Edit') {
                            delete $scope.additionalTermSaveObj["Id"];
                            $scope.saveType = 'New';
                        }
                        
                        $scope.additionalTermSaveObj.Term_Name__c = $scope.additionalTermObj.Term_Name__c;
                        $scope.additionalTermSaveObj.Addtional_Term__c = $scope.additionalTermObj.additionalTerm;
                        $scope.additionalTermSaveObj.TPA_Request__c = $scope.additionalTermObj.tpaRequest.Id;
                        $scope.additionalTermSaveObj.Category__c = $scope.additionalTermObj.selectedCategory;
                        $scope.additionalTermSaveObj.Do_Not_Apply_if_Renewed__c = $scope.additionalTermObj.doNotApply;
                        $scope.additionalTermSaveObj.Exhibit_Attached__c = $scope.additionalTermObj.exhibitPageRequired;
                        $scope.additionalTermSaveObj.Parent_Additional_Terms__c = $scope.additionalTermObj.Parent_Additional_Terms__c;
                        
                        if($scope.additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term' || $scope.additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms') {
                            $scope.additionalTermSaveObj.Country_of_Offering__c = $scope.additionalTermObj.countryOfOffering.country;
                            if($scope.additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms'){
                            	$scope.additionalTermSaveObj.Use_Name__c = $scope.additionalTermObj.selectedUse.useName;
                            }
                            else {
                                $scope.additionalTermSaveObj.Use_Name__c = '';
                            }
                            $scope.additionalTermSaveObj.Primary_Offering_Name__c = $scope.additionalTermObj.selectedPriOffering.Asset_Name__c;
                            if($scope.additionalTermObj.selectedSecOffering != null && $scope.additionalTermObj.selectedPriOffering.TPA_Secondary_Data_Assets__r != null) {
                                $scope.additionalTermSaveObj.Secondary_Offering_Name__c = $scope.additionalTermObj.selectedSecOffering.Secondary_Asset_Name__c;  
                                $scope.additionalTermSaveObj.TPA_Legal_Entity_1__c = $scope.additionalTermObj.selectedSecOffering.IMS_Legal_Entity__c;                              
                            }
                            else {
                                $scope.additionalTermSaveObj.Secondary_Offering_Name__c = '';
                                $scope.additionalTermSaveObj.TPA_Legal_Entity_1__c = $scope.additionalTermObj.selectedPriOffering.IMSLegalEntity__c; 
                            }
                            $scope.additionalTermSaveObj.Is_All_Legal_Entities_Selected__c = false;
                        } else if($scope.additionalTermObj.selectedCategory == 'Use Specific Ad-Hoc Terms'){
                            var legalEntityName = '';
                            var count = 0;
                            $.each($scope.usesUniqueList, function(idx,value){
                                if(value.useName == $scope.additionalTermObj.selectedUse.useName && legalEntityName != value.imsLegalEntity){
                                    legalEntityName = value.imsLegalEntity;
                                    count++;
                                }
                            });
                            if(count > 1){
                                $scope.additionalTermSaveObj.Is_All_Legal_Entities_Selected__c = true;
                            }
                            else {
                                $scope.additionalTermSaveObj.TPA_Legal_Entity_1__c = legalEntityName;
                                $scope.additionalTermSaveObj.Is_All_Legal_Entities_Selected__c = false;
                            }
                            $scope.additionalTermSaveObj.Use_Name__c = $scope.additionalTermObj.selectedUse.useName;
                            $scope.additionalTermSaveObj.Country_of_Offering__c = '';
                            $scope.additionalTermSaveObj.Primary_Offering_Name__c = '';
                            $scope.additionalTermSaveObj.Secondary_Offering_Name__c = '';
                        } else if($scope.additionalTermObj.selectedCategory == 'General Ad-Hoc Term'){
                            $scope.additionalTermSaveObj.Use_Name__c = '';
                            $scope.additionalTermSaveObj.Primary_Offering_Name__c = '';
                            $scope.additionalTermSaveObj.Secondary_Offering_Name__c = '';
                            $scope.additionalTermSaveObj.Country_of_Offering__c = '';
                            $scope.additionalTermSaveObj.Is_All_Legal_Entities_Selected__c = true;
                        }
                        
                        $scope.$log.info('$scope.additionalTermSaveObj= ' + JSON.stringify($scope.additionalTermSaveObj));
                        
                        onActionClick();
                        
                        CNT_TPA_Additional_Terms.saveRequest(JSON.stringify($scope.additionalTermSaveObj).replace(/null/i, "\"\""), ($scope.exhibitPageDoc != null ? JSON.stringify($scope.exhibitPageDoc) : '') ,$scope.additionalTermObj.tpaRequest.Id,$scope.saveType,$scope.prevExhibitAttached, function(result, event) {
                            $scope.$log.warn(result);
                            if(event.type == 'exception') {
                                onActionComplete(); 
                                $scope.$log.info('Error: ' + event.message);
                                return false;                                    
                            }
                            else if(result != null) {   
                                onActionComplete(); 
                                $scope.$log.info('Success');
                                result = JSON.parse($scope.parseHTML(result));
                                $scope.existingAdditionalTermsMap = result.termsMap;
                                $scope.existingAttachIdMap = result.attachmentMap;
                                $scope.exhibitPageDoc = {};
                                console.log('$scope.existingAttachIdMap'+JSON.stringify($scope.existingAttachIdMap));
                                $scope.resetForm();
                                $scope.applyChanges();
                            }
                        });
                    }

                    $scope.deleteTerm = function(Obj) {
                        $scope.$log.info('delete = ' + Obj.Id);

                        var parentAddTerm = '';
                        if(Obj.Parent_Additional_Terms__c != undefined && Obj.Parent_Additional_Terms__c != null){
                            parentAddTerm = Obj.Parent_Additional_Terms__c;
                        }

                        $scope.$log.info('$scope.additionalTermObj.tpaRequest.Request_status__c : ' + $scope.additionalTermObj.tpaRequest.Request_Status__c);
                        var requestStatus = $scope.additionalTermObj.tpaRequest.Request_Status__c.toLowerCase();
                        if(requestStatus == 'ama siscontinued'
                        || requestStatus == 'in effect'
                        || requestStatus == 'cancelled'
                        || requestStatus == 'client discontinued'
                        || requestStatus == 'ama cancelled'
                        || requestStatus == 'closed-iqvia affiliate'
                        || requestStatus == 'ama cancelled'
                        || requestStatus == 'expired'
                        || requestStatus == 'awaiting vendor signature') {
                            $scope.popupAlert('Additional terms can not be added or updated or deleted as TPA request is in ' + $scope.additionalTermObj.tpaRequest.Request_Status__c + ' Status.');
                            $scope.isStatusError = true;
                            return false;
                        }
                        
                        onActionClick();
                        
                        CNT_TPA_Additional_Terms.deleteAdditionalTerm(angular.copy(Obj.Id),angular.copy(parentAddTerm), angular.copy(Obj.Term_Name__c), $scope.additionalTermObj.tpaRequest.Id, function(result, event) {
                            $scope.$log.warn(result);
                            if(event.type == 'exception') {
                                onActionComplete(); 
                                $scope.$log.info('Error: ' + event.message);
                                return false;                                    
                            }
                            else {   
                                onActionComplete(); 
                                $scope.$log.info('Success');
                                result = JSON.parse($scope.parseHTML(result));
                                $scope.existingAdditionalTermsMap = result;
                                $scope.existingAttachIdMap = {!JSONAdditionalTermsAttachId};
                                $scope.resetForm();
                                $scope.applyChanges();
                            }
                        });
                    }
                    
                    $scope.resetForm = function() {
                        $scope.saveType = '';
                        $scope.additionalTermSaveObj.Id = '';
                        $scope.additionalTermObj.selectedPriOffering = $scope.priOfferingsList[0];
                        $scope.additionalTermObj.countryOfOffering = $scope.usesCountryList[0];
                        $scope.additionalTermObj.selectedUse = $scope.usesUniqueList[0];
                        $scope.additionalTermObj.selectedSecOffering = '';
                        $scope.additionalTermObj.additionalTerm = '';
                        $scope.additionalTermObj.Term_Name__c = '';
                        $scope.additionalTermObj.selectedCategory = $scope.categoryOptionsList[0];      
                        $scope.additionalTermObj.Is_All_Legal_Entities_Selected__c = false;
                        $scope.additionalTermObj.doNotApply = false;
                        $scope.additionalTermObj.exhibitPageRequired = false;
                        $scope.additionalTermObj.Parent_Additional_Terms__c = '';
                        $scope.prevExhibitAttached = false;
                        //document.getElementById('uploadFileId').value = '';
                        //document.getElementById('uploadFileId').files = [];
                        let f = document.getElementById('uploadFileId');
                        if(f != null && f.value){ 
                            var form = document.createElement('form'),
                            parentNode = f.parentNode, ref = f.nextSibling;
                            form.appendChild(f);
                            form.reset();
                            parentNode.insertBefore(f,ref);
                        }
                    }

                    $scope.oldRecord = null;

                    $scope.editRecord = function(obj) {
                        $scope.saveType = 'Edit';
                        $scope.oldRecord = obj;
                        $scope.exhibitAddedAtCurrentRcrd = false;
                        if(obj.Exhibit_Attached__c){
                            $scope.exhibitAddedAtCurrentRcrd = true;
                        }

                        $scope.additionalTermSaveObj.Id = angular.copy(obj.Id);
                        $scope.additionalTermObj.Term_Name__c = angular.copy(obj.Term_Name__c);
                        $scope.additionalTermObj.selectedSecOffering = null;
                        $scope.additionalTermObj.selectedCategory = obj.Category__c;
                        
                        $scope.useDuplicateCheck = {};
                        $.each($scope.usesUniqueList, function(idx1,value1){
                            if(value1.useName == obj.Use_Name__c && $scope.useDuplicateCheck[value1.useName] == null){
                                $scope.$log.info('obj.Use_Name__c::obj.TPA_Legal_Entity_1__c : ' + obj.TPA_Legal_Entity_1__c+':' +obj.Use_Name__c+':'+value1.imsLegalEntity);
                                $scope.useDuplicateCheck[obj.Use_Name__c ] = obj.Use_Name__c ;
                                $scope.additionalTermObj.selectedUse = value1;
                            }
                        });
                        
                        $scope.countryDuplicateCheck = {};
                        $.each($scope.usesCountryList, function(idx,value){
                            if(obj.Country_of_Offering__c != null && $scope.countryDuplicateCheck[obj.Country_of_Offering__c] == null && ((obj.Category__c == 'Use/Offering Specific Ad-Hoc Terms' && obj.Use_Name__c != null && value.country == obj.Country_of_Offering__c && value.useName == obj.Use_Name__c) || (obj.Category__c == 'Data Asset Specific Ad-Hoc Term' && value.country == obj.Country_of_Offering__c && value.imsLegalEntity == obj.TPA_Legal_Entity_1__c))){
                                $scope.countryDuplicateCheck[obj.Country_of_Offering__c] = obj.Country_of_Offering__c;
                                $scope.additionalTermObj.countryOfOffering = value;
                            }
                        });
                                
                        $.each($scope.priOfferingsList , function(k, v) {
                            if(obj.Primary_Offering_Name__c == v.Asset_Name__c && (obj.Use_Name__c == null || obj.Use_Name__c == v.A_Column_Use_For_Template__c )&& obj.Country_of_Offering__c == v.BU__c) {
                                $scope.additionalTermObj.selectedPriOffering = v;
                                if(v.TPA_Secondary_Data_Assets__r != null) {
                                    $.each(v.TPA_Secondary_Data_Assets__r.records , function(k1, v1) {   
                                        if(obj.Secondary_Offering_Name__c == v1.Secondary_Asset_Name__c)
                                            $scope.additionalTermObj.selectedSecOffering = v1;
                                    });
                                }
                            }
                        });
                        
                        
                        
                        $scope.additionalTermObj.additionalTerm = obj.Addtional_Term__c;
                        $scope.additionalTermObj.doNotApply = obj.Do_Not_Apply_if_Renewed__c;
						$scope.additionalTermObj.exhibitPageRequired = obj.Exhibit_Attached__c;
                        $scope.additionalTermObj.Parent_Additional_Terms__c = obj.Parent_Additional_Terms__c;
                        $scope.prevExhibitAttached = obj.Exhibit_Attached__c;
                    }

                    $scope.checkIfEqual = function(val1,val2){
                        val1 = (val1 == null || val1 == undefined) ? '' : val1;
                        val2 = (val2 == null || val2 == undefined || val2 == '--None--') ? '' : val2;
                        return val1 == val2;
                    }
                                                                 
                    $scope.validateForm = function() {
                        $scope.$log.info('$scope.additionalTermObj.tpaRequest.Request_status__c : ' + $scope.additionalTermObj.tpaRequest.Request_Status__c);
                        var requestStatus = $scope.additionalTermObj.tpaRequest.Request_Status__c.toLowerCase();
                        if(requestStatus == 'ama siscontinued'
                        || requestStatus == 'in effect'
                        || requestStatus == 'cancelled'
                        || requestStatus == 'client discontinued'
                        || requestStatus == 'ama cancelled'
                        || requestStatus == 'closed-iqvia affiliate'
                        || requestStatus == 'ama cancelled'
                        || requestStatus == 'expired'
                        || requestStatus == 'awaiting vendor signature') {
                            if(requestStatus != 'in effect' 
                                || (!$scope.checkIfEqual($scope.oldRecord.Term_Name__c,$scope.additionalTermObj.Term_Name__c)
                                    || !$scope.checkIfEqual($scope.oldRecord.Addtional_Term__c,$scope.additionalTermObj.additionalTerm) 
                                    || !$scope.checkIfEqual($scope.oldRecord.Category__c , $scope.additionalTermObj.selectedCategory )
                                    || !$scope.checkIfEqual($scope.oldRecord.Use_Name__c , $scope.additionalTermObj.selectedUse.useName)
                                    || ($scope.oldRecord.Category__c != 'Use Specific Ad-Hoc Terms' && !$scope.checkIfEqual($scope.oldRecord.Country_of_Offering__c , $scope.additionalTermObj.countryOfOffering.country))
                                    || !$scope.checkIfEqual($scope.oldRecord.Primary_Offering_Name__c , $scope.additionalTermObj.selectedPriOffering.Asset_Name__c)
                                    || !$scope.checkIfEqual($scope.oldRecord.Secondary_Offering_Name__c , ($scope.additionalTermObj.selectedSecOffering != null ? $scope.additionalTermObj.selectedSecOffering.Secondary_Asset_Name__c : ''))
                                    || !$scope.checkIfEqual($scope.oldRecord.Exhibit_Attached__c , $scope.additionalTermObj.exhibitPageRequired)
                                    || $scope.checkIfEqual($scope.oldRecord.Do_Not_Apply_if_Renewed__c , $scope.additionalTermObj.doNotApply))
                            ){
                                $scope.popupAlert('Additional terms can not be added or updated or deleted as TPA request is in ' + $scope.additionalTermObj.tpaRequest.Request_Status__c + ' Status.');
                                $scope.isStatusError = true;
                                return false;
                            }
                        }

                        if($scope.additionalTermObj.Term_Name__c == null || $scope.additionalTermObj.Term_Name__c == '') {
                            $scope.popupAlert('Please select additional term name');
                            $scope.isAdditionalTermNameEmpty = true;
                            return false;
                        }

                        if(($scope.saveType != 'Edit' || ($scope.saveType == 'Edit' && !$scope.exhibitAddedAtCurrentRcrd) ) && $scope.additionalTermObj.exhibitPageRequired && ( document.getElementById('uploadFileId').files == null || document.getElementById('uploadFileId').files.length < 1)) {
                            $scope.popupAlert('You have checked that this Ad-hoc Additional Term requires a related Exhibit / Schedule Page.  You still need to attach the Exhibit / Schedule Page and the document MUST be on the required IQVIA Template.');
                            $scope.isExhibitNotAttched = true;
                            return false;
                        }

                        if($scope.additionalTermObj.selectedCategory == null || $scope.additionalTermObj.selectedCategory == '' || $scope.additionalTermObj.selectedCategory == '--None--') {
                            $scope.popupAlert('Please select category');
                            $scope.isCategoryEmpty = true;
                            return false;
                        }
                        
                        if(($scope.additionalTermObj.selectedCategory == 'Use Specific Ad-Hoc Terms' || $scope.additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms') && ($scope.additionalTermObj.selectedUse.useName == null || $scope.additionalTermObj.selectedUse.useName == '' || $scope.additionalTermObj.selectedUse.useName == '--None--')) {
                            $scope.popupAlert('Please select Use');
                            $scope.isUseEmpty = true;
                            return false;
                        }
                        
                        if(($scope.additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term' || ($scope.additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms' && $scope.additionalTermObj.selectedUse.useName != '--None--')) && ($scope.additionalTermObj.countryOfOffering.country == null || $scope.additionalTermObj.countryOfOffering.country == '' || $scope.additionalTermObj.countryOfOffering.country == '--None--')) {
                            $scope.popupAlert('Please select Country');
                            $scope.isCountryEmpty = true;
                            return false;
                        }
                        
                        if(($scope.additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term' || $scope.additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms' )&& ($scope.additionalTermObj.selectedPriOffering == null || $scope.additionalTermObj.selectedPriOffering == '' || $scope.additionalTermObj.selectedPriOffering.Asset_Name__c == '--None--')) {
                            $scope.popupAlert('Please select Primary Offering');
                            $scope.isPriOfferingEmpty = true;
                            return false;
                        }
                        if($scope.additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term' 
                        && $scope.additionalTermObj.selectedPriOffering != null 
                        && $scope.additionalTermObj.selectedPriOffering.TPA_Secondary_Data_Assets__r != null 
                        && $scope.additionalTermObj.selectedPriOffering.TPA_Secondary_Data_Assets__r.records != null 
                        && $scope.additionalTermObj.selectedPriOffering.TPA_Secondary_Data_Assets__r.records.length > 0
                        && ($scope.additionalTermObj.selectedSecOffering == null || $scope.additionalTermObj.selectedSecOffering == '' || $scope.additionalTermObj.selectedSecOffering.Secondary_Asset_Name__c == '--None--')) {
                            $scope.popupAlert('Please select Secondary Offering');
                            $scope.isSecOfferingEmpty = true;
                            return false;
                        }

                        if($scope.additionalTermObj.additionalTerm == null || $scope.additionalTermObj.additionalTerm == '') {
                            $scope.popupAlert('Please provide additional term');
                            $scope.isAdditionalTermEmpty = true;
                            return false;
                        }
                        return true;
                    }

                    $scope.validateAndUploadFile = function (){
                        
                        var reader = new FileReader();
                        var attachFile = document.getElementById('uploadFileId').files[0];
                        
                        if(attachFile == undefined){
                            //alert('Attachment required to proceed');
                            return;
                        }
                        
                        reader.onload = function(e) {
                            var attachment = {};  
                            attachment.Name = attachFile.name;
                            attachment.mimeType = attachFile.type;
                            attachment.body = (new sforce.Base64Binary(e.target.result)).toString();;
                            $scope.exhibitPageDoc = attachment;
                        };
                        reader.readAsBinaryString(attachFile);
                    }
                    
                                                                             
                    //*** function triggers and applies all angular scope changes explicitly ***//
                    $scope.applyChanges = function()
                    {
                        if ($scope.$root.$$phase != '$apply' && $scope.$root.$$phase != '$digest')
                            $scope.$apply();
                    }

                    $scope.returnToRequest = function() {
                        window.location.href = location.protocol + '//' + location.hostname + '/' + $scope.additionalTermObj.tpaRequest.Id;
                    }
                    
                    $scope.popupAlert = function(msg, truePart)
                    {
                        popup(msg, {'animate':true}, 
                        function(r)
                        {
                            if(r && truePart != null)
                                truePart();
                        });  
                    }
                    //****** Angular Apply All Changes Event End ******//
                }]);
                
                
                //AngularJs App End----------------------------------------------------------------------------------
            </script>
            <!-- ****** AngularJS script End ****** -->
            <apex:slds />
            <apex:includeLightning />
        </head>
        <body style="background-image: url(/_slds/images/themes/lightning_blue/lightning_blue_background.png),linear-gradient(to top, rgba(160, 180, 206, 0.0) 0, rgba(160, 180, 206, 1.0)); background-repeat: no-repeat; background-size: cover; min-height: 100vh">
            <div class="slds-scope">
                <apex:form html-class="slds-form slds-form_horizontal">
                    <div id="ng-app" ng-app="AdditionalTermsApp">
                        <div id="controllerPage" ng-controller="controllerPage">
                            <apex:pageMessages id="message" />
                            <apex:pageBlock title="TPA Ad-Hoc Additional Terms">
                                <apex:pageBlockButtons location="top">
                                    <button class="btn btn-default" style="font-weight: bold; font-size: 12px" ng-click="SaveReuest()" onclick="return false;">Save</button>
                                    <button class="btn btn-default" style="font-weight: bold; font-size: 12px" ng-click="resetForm()" onclick="return false;">Reset</button>
                                    <button class="btn btn-default" style="font-weight: bold; font-size: 12px" ng-click="returnToRequest();" onclick="return false;" >Return</button>
                                </apex:pageBlockButtons>
                                <apex:pageBlockSection html-style="background-color:white;" columns="2" title="New Ad-Hoc Addtional Term">
                                    <apex:pageBlockSectionItem >
                                        <apex:outputPanel >
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label">
                                                    <abbr class="slds-required" title="required">* </abbr>Ad-hoc Additional Term Subject Name
                                                </label>
                                                <c:VFC_TPA_LightningHelpText cHlpTxt="Note: The input of this field will be bolded as a descriptive label just before the additional term in the TLLA under Additional Terms section of the Schedule."/>   
                                                <div id="opPanel" class="slds-form-element__control" >
                                                    <input class="slds-m-left_small slds-input" type="text" maxlength="255" onfocus="helpTextShow()" ng-model="additionalTermObj.Term_Name__c" onblur = "helpTextHide()"/>
                                                    <div style = "color:red; font-size: 8px; display:none;" id =  "helpText">
                                                        Maximum character limit is 255
                                                    </div>
                                                </div>
                                            </div>
                                        </apex:outputPanel>   
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label">
                                                <abbr class="slds-required" title="required">* </abbr>TPA Request
                                            </label>
                                            <div id="opPanel" class="slds-form-element__control">
                                                {{additionalTermObj.tpaRequest.Name}}
                                            </div>
                                        </div>
                                    </apex:pageBlockSectionItem>                                    
                                    <apex:pageBlockSectionItem >
                                        <apex:outputPanel >
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label">
                                                    <abbr class="slds-required" title="required">* </abbr>Ad-hoc Additional Term Category
                                                </label>
                                                <c:VFC_TPA_LightningHelpText cHlpTxt="1. Data Asset Specific Ad-Hoc Term: Application of a specific Offering(s) related term 2. General Ad-Hoc Term: Application of a general term that would apply to the overall TLLA 3. Use Specific Ad-Hoc Terms: Application of a specific Use(s) related term 4. Use/Offering Specific Ad-Hoc Terms: Application of a specific Use/Offering(s) related term"/>   
                                                <div id="opPanel" class="slds-form-element__control">
                                                    <select id="idPriOffering" class="slds-m-left_small" ng-model="additionalTermObj.selectedCategory" ng-options="v for v in categoryOptionsList" ng-change="categoryOptionUpdate()">
                                                    </select>
                                                </div>
                                            </div>
                                        </apex:outputPanel> 
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label">
                                                <abbr class="slds-required" title="required">* </abbr>Ad-hoc Additional Term
                                            </label>
                                            <div id="opPanel" class="slds-form-element__control">
                                                <textarea class="slds-size_1-of-2 slds-textarea" ng-model="additionalTermObj.additionalTerm"></textarea>
                                            </div>
                                        </div>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem html-ng-if="additionalTermObj.selectedCategory == 'Use Specific Ad-Hoc Terms' || additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms' || additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term'" >
                                        <div class="slds-form-element" ng-show="additionalTermObj.selectedCategory == 'Use Specific Ad-Hoc Terms' || additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms'" >
                                            <label class="slds-form-element__label">
                                                <abbr class="slds-required" title="required">* </abbr>Use
                                            </label>
                                            <div id="opPanel" class="slds-form-element__control" >
                                                <select id="selectedUse" class="slds-m-left_small" ng-model="additionalTermObj.selectedUse" ng-options="v.useName for v in usesUniqueList | filter: filterUses()" style = 'width: fit-content;max-width:100%;'>
                                                </select>
                                            </div>
                                        </div>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem html-ng-if="additionalTermObj.selectedCategory == 'Use Specific Ad-Hoc Terms' || additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms' || additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term'" >
                                        <div class="slds-form-element" ng-if="additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term' || (additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms' && additionalTermObj.selectedUse != null && additionalTermObj.selectedUse.useName != '--None--')" >
                                            <label class="slds-form-element__label">
                                                <abbr class="slds-required" title="required">* </abbr>Country
                                            </label>
                                            <div id="opPanel" class="slds-form-element__control">
                                                <select id="selectedUse" ng-model="additionalTermObj.countryOfOffering" ng-options="v.country for v in usesCountryList | filter: filterCountries()" >
                                                </select>
                                            </div>
                                        </div>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem html-ng-if="(additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term' || (additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms' && additionalTermObj.selectedUse != '--None--')) && additionalTermObj.countryOfOffering.country != null && additionalTermObj.countryOfOffering.country != '--None--'">
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label">
                                                <abbr class="slds-required" title="required">* </abbr>Primary Offering
                                            </label>
                                            <div id="opPanel" class="slds-form-element__control">
                                                <select id="idPriOffering" class="slds-m-left_small" ng-model="additionalTermObj.selectedPriOffering" ng-options="v.Asset_Name__c for v in priOfferingsList | filter: filterByPriOfferings()" ng-change="additionalTermObj.selectedSecOffering = additionalTermObj.selectedPriOffering.TPA_Secondary_Data_Assets__r.records[0];" style = 'width: fit-content;max-width:100%;' >
                                                </select>
                                            </div>
                                        </div>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem html-ng-if="(additionalTermObj.selectedCategory == 'Data Asset Specific Ad-Hoc Term' || (additionalTermObj.selectedCategory == 'Use/Offering Specific Ad-Hoc Terms' && additionalTermObj.selectedUse != '--None--')) && additionalTermObj.countryOfOffering.country != null && additionalTermObj.countryOfOffering.country != '--None--'">
                                        <apex:outputPanel html-ng-if="additionalTermObj.selectedPriOffering != null && additionalTermObj.selectedPriOffering.Asset_Name__c != '--None--' && additionalTermObj.selectedPriOffering.TPA_Secondary_Data_Assets__r != null && additionalTermObj.selectedPriOffering.TPA_Secondary_Data_Assets__r.records.length > 0" >
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label">
                                                    <abbr class="slds-required" title="required">* </abbr>Secondary Offering
                                                </label>
                                                <div id="opPanel" class="slds-form-element__control">
                                                    <select id="idSecOffering" ng-model="additionalTermObj.selectedSecOffering" ng-options="v.Secondary_Asset_Name__c for v in additionalTermObj.selectedPriOffering.TPA_Secondary_Data_Assets__r.records" style = 'width: fit-content;max-width:100%;'>
                                                    </select>
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                    </apex:pageBlockSectionItem> 
                                    <apex:pageBlockSectionItem rendered="{!showExhibitPage}">
                                        <apex:outputPanel >
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label">
                                                <abbr title="required">* </abbr>Related Ad-Hoc Term Requires Exhibit / Schedule Page : 
                                            </label>
                                            <div id="opPanel" class="slds-form-element__control" style="margin-top:15px;text-align:center;width: 40%;">
                                                <input type="checkbox" ng-model="additionalTermObj.exhibitPageRequired"/>
                                            </div>
                                            <div  style="display: block;float: left;font-size: 11.5px;margin-top: 20px;color:rgb(68, 68, 68);">
                                                <b>Note:</b> <i>The Exhibit/Schedule Page should only be used when a related term necessitates displaying a comprehensive list or table of permitted fields that can be shared.</i>
                                            </div>
                                            <div class="slds-size_1-of-1" ng-show="additionalTermObj.exhibitPageRequired" style="display: block;float: left;font-size: 11.5px;margin-top: 20px;color:rgb(68, 68, 68);">
                                                <b>IMPORTANT:</b> The Exhibit Page must be on a specific IQVIA template.
                                                <ul>
                                                    <li>1. Click to <a href="{!URLFOR($Resource.ExhibitDemoPage)}" style="color:black"><u>download template.</u></a></li>
                                                    <li>2. Add your content to the downloaded template.</li>
                                                    <li>3. Then use the button below to upload the completed Exhibit Page.</li>
                                                    <li>4. The system will automatically append the uploaded Exhibit Page to the TLLA.</li>
                                                </ul>    
                                                <!--<span>IMPORTANT: The Exhibit/Schedule Page should only be used when a related term necessitates displaying a comprehensive list or table of permitted fields that can be shared. The Page must be on IQVIA template found on the TP Processor SharePoint.  The Page will be automatically appended to the TLLA.</span>-->
                                            </div>
                                            <!--<apex:outputLink styleClass="btn" style="margin:20px 0px;float:left;padding:7px;color:black;" value="{!URLFOR($Resource.ExhibitDemoPage)}" target="_blank">Download Blank Exhibit Page</apex:outputLink>-->
                                            <div ng-show="additionalTermObj.exhibitPageRequired" id="opPanel" style="display: block;">
                                                <input class="slds-m-top_small slds-button slds-button_neutral slds-size_1-of-3" type="file" id="uploadFileId" name='file' onchange="angular.element(this).scope().validateAndUploadFile()" />
                                            </div>
                                        </div>
                                        </apex:outputPanel>
                                    </apex:pageBlockSectionItem> 
                                   	<apex:pageBlockSectionItem >
                                        <apex:outputPanel >
                                        <div class="slds-form-element" ng-hide="isGlobalUser == false">
                                            <label class="slds-form-element__label" style="width:27%;">
                                                <abbr class="slds-required" title="required">* </abbr>Do Not Apply this Ad-hoc Term if Renewed
                                            </label>
                                            <c:VFC_TPA_LightningHelpText cHlpTxt="By checking this box, you are saying this term should not be added/reviewed if this TPA is Renewed."/> 
                                            <div id="opPanel" class="slds-form-element__control" style="margin-top: 2%;text-align: center;width: 30%;">
                                                <input type="checkbox" ng-model="additionalTermObj.doNotApply"/>
                                            </div>
                                        </div>
                                        </apex:outputPanel>
                                    </apex:pageBlockSectionItem>
                                </apex:pageBlockSection>
                                <apex:pageBlockSection html-style="background-color:white;" columns="1" title="Existing Ad-Hoc Additional Terms">
                                    <apex:outputPanel >
                                        <div class="tableWrapper">
                                            <table id="additionalTermsTable" class="slds-table slds-table--bordered slds-table_col-bordered slds-border_left slds-border_right" role="grid">
                                                <thead class="slds-theme_shade"> 
                                                    <tr class="slds-text-heading slds-line-height_reset ">
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Action" /></th>
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Ad-hoc Additional Term Subject Name" /></th>
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Ad-hoc Additional Term Category" /></th>
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Ad-hoc Additional Term" /></th>   
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Legal Entity Name" /></th>                    
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Use Name" /></th>
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Primary Offering Name" /></th>
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Secondary Offering Name" /></th>
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Ad-hoc Exhibit / Schedule Page" /></th>
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Is Future Approved" /></th>                          
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Ad-hoc Term Last Entered By" /></th>
                                                        <th class="headerRow slds-cell-wrap"><apex:outputLabel value="Ad-hoc Term Last Updated" /></th>
                                                    </tr>
                                                </thead>
                                                <tr class="dataRow" ng-repeat="(key, data) in existingAdditionalTermsMap" onfocus="if (window.hiOn){hiOn(this);}" onblur="if (window.hiOff){hiOff(this);}" onmouseout="if (window.hiOff){hiOff(this);} " onmouseover="if (window.hiOn){hiOn(this);} ">
                                                    <td>
                                                        <a href="javascript:void(0)" style="text-decoration: underline;" ng-click="editRecord(data);">Edit</a>
                                                        <a href="javascript:void(0)" style="text-decoration: underline;" ng-click="deleteTerm(data);">Delete</a>
                                                    </td>
                                                    <td class="dataCell slds-cell-wrap">{{data.Term_Name__c}}</td>
                                                    <td class="dataCell slds-cell-wrap">{{data.Category__c}}</td>
                                                    <td class="dataCellAdd slds-cell-wrap">{{data.Addtional_Term__c}}</td>                                               
                                                    <td class="dataCell slds-cell-wrap">{{data.TPA_Legal_Entity_1__r.Legal_Entity_Name_for_TLLA__c}}</td>
                                                    <td class="dataCell slds-cell-wrap">{{data.Use_Name__c}}</td>
                                                    <td class="dataCell slds-cell-wrap">{{data.Primary_Offering_Name__c}}</td>
                                                    <td class="dataCell slds-cell-wrap">{{data.Secondary_Offering_Name__c}}</td>  
                                                    <td class="dataCell slds-cell-wrap"><span ng-show="existingAttachIdMap != null && existingAttachIdMap[data.Id] != null"><a href="/servlet/servlet.FileDownload?file={{existingAttachIdMap[data.Id]}}" target="_blank">Click Here To View</a></span></td>  
                                                    <td class="dataCell slds-cell-wrap">{{data.Is_Future_Approved__c}}</td>  
                                                    <td class="dataCell slds-cell-wrap">{{data.Ad_hoc_Term_Last_Entered_By__c}}</td>
                                                    <td class="dataCell slds-cell-wrap">{{dateFormatter(data.Ad_hoc_Term_Last_Updated__c)}}</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </apex:outputPanel>
                                </apex:pageBlockSection>
                            </apex:pageBlock>
                        </div>
                    </div>
                </apex:form>
            </div>
        </body>
    </html>
</apex:page>

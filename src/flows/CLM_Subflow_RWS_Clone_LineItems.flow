<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>59.0</apiVersion>
    <assignments>
        <description>Agreement LineItem Collection</description>
        <name>Agreement_LineItem_Collection</name>
        <label>Agreement LineItem Collection</label>
        <locationX>138</locationX>
        <locationY>758</locationY>
        <assignmentItems>
            <assignToReference>AgreementlineItemCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>AgreementLineItemInstance</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Agreement_LineItem</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Agreement_LineItem_Instance</name>
        <label>Agreement LineItem Instance</label>
        <locationX>706</locationX>
        <locationY>638</locationY>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus__ProductId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.Product2Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus__NetPrice__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.UnitPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus__Quantity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.Quantity</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Sale_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.Sale_Type__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Revenue_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.Revenue_Type__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus_CMConfig__BillingFrequency__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.Billing_Frequency__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus_CMConfig__StartDate__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.Product_Start_Date__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus_CMConfig__EndDate__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.Product_End_Date__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus__Description__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.Description</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus__AgreementId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>newRecord.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Unit_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.Unit_Name__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Delivery_Frequency__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.Proj_Rpt_Frequency__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.CurrencyIsoCode</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Opportunity_LineItems.CurrencyIsoCode</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Collect_Agreemt_LineItem</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Agreement LineItem Instance2</description>
        <name>Agreement_LineItem_Instance2</name>
        <label>Agreement LineItem Instance</label>
        <locationX>138</locationX>
        <locationY>638</locationY>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus__AgreementId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>newRecord.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus__ProductId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Apttus__ProductId__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus__NetPrice__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Apttus__NetPrice__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus__Quantity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Apttus__Quantity__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Country__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Country__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Sale_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Sale_Type__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Revenue_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Revenue_Type__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus_CMConfig__BillingFrequency__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Apttus_CMConfig__BillingFrequency__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus_CMConfig__StartDate__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Apttus_CMConfig__StartDate__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus_CMConfig__EndDate__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Apttus_CMConfig__EndDate__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Apttus__Description__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Apttus__Description__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Unit_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Unit_Name__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.Delivery_Frequency__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.Delivery_Frequency__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>AgreementLineItemInstance.CurrencyIsoCode</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Agreement_LineItem.CurrencyIsoCode</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Agreement_LineItem_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add induvidual line itme to collection.</description>
        <name>Collect_Agreemt_LineItem</name>
        <label>Collect Agreemt LineItem</label>
        <locationX>706</locationX>
        <locationY>758</locationY>
        <assignmentItems>
            <assignToReference>AgreementlineItemCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>AgreementLineItemInstance</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Opportunity_LineItems</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>Agreement lineItem null check</description>
        <name>Agreement_lineItem_null_check</name>
        <label>Agreement lineItem null check</label>
        <locationX>158</locationX>
        <locationY>398</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Agreement_lineItem_not_null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Agreement_Line_Items</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Agreement_LineItem</targetReference>
            </connector>
            <label>Agreement lineItem not null</label>
        </rules>
    </decisions>
    <decisions>
        <description>Get the Agreement Version no to decide the source of Line Item for cloning.</description>
        <name>Agreement_Version_0</name>
        <label>Agreement Version 0</label>
        <locationX>442</locationX>
        <locationY>158</locationY>
        <defaultConnector>
            <targetReference>Get_Opportunity_LineItems</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Version 0</defaultConnectorLabel>
        <rules>
            <name>Version_not_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>newRecord.Apttus__Version_Number__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Agreement_Line_Items</targetReference>
            </connector>
            <label>Version not 0</label>
        </rules>
    </decisions>
    <decisions>
        <description>check for null</description>
        <name>opportunity_LineItem_null_check</name>
        <label>opportunity LineItem null check</label>
        <locationX>726</locationX>
        <locationY>398</locationY>
        <defaultConnector>
            <targetReference>Create_Agreement_LineItems</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Opp_LineItem_is_not_null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Opportunity_LineItems</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Opportunity_LineItems</targetReference>
            </connector>
            <label>Opp LineItem is not null</label>
        </rules>
    </decisions>
    <interviewLabel>CLM Subflow: RWS Clone LineItems {!$Flow.CurrentDateTime}</interviewLabel>
    <label>CLM Subflow : Copy Agreement Line Items From OLI</label>
    <loops>
        <description>Loop Agreement LineItem</description>
        <name>Loop_Agreement_LineItem</name>
        <label>Loop Agreement LineItem</label>
        <locationX>50</locationX>
        <locationY>518</locationY>
        <collectionReference>Get_Agreement_Line_Items</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Agreement_LineItem_Instance2</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_Agreement_LineItems</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Loop through each line items to set variable values for Agreement collection.</description>
        <name>Loop_Opportunity_LineItems</name>
        <label>Loop_Opportunity_LineItems</label>
        <locationX>618</locationX>
        <locationY>518</locationY>
        <collectionReference>Opportunity_LineItem_Collection</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Agreement_LineItem_Instance</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_Agreement_LineItems</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <description>Create all Agreement LineItems</description>
        <name>Create_Agreement_LineItems</name>
        <label>Create Agreement LineItems</label>
        <locationX>442</locationX>
        <locationY>1166</locationY>
        <inputReference>AgreementlineItemCollection</inputReference>
    </recordCreates>
    <recordLookups>
        <description>Get Agreement Line Items from last version of agreement.</description>
        <name>Get_Agreement_Line_Items</name>
        <label>Get Agreement Line Items</label>
        <locationX>158</locationX>
        <locationY>278</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Agreement_lineItem_null_check</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Apttus__AgreementId__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>newRecord.Agreement_Cloned_From__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Apttus__AgreementLineItem__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get Opportunity Line Items for Agreement.</description>
        <name>Get_Opportunity_LineItems</name>
        <label>Get Opportunity LineItems</label>
        <locationX>726</locationX>
        <locationY>278</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>opportunity_LineItem_null_check</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>newRecord.Apttus__Related_Opportunity__c</elementReference>
            </value>
        </filters>
        <object>OpportunityLineItem</object>
        <outputReference>Opportunity_LineItem_Collection</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Product2Id</queriedFields>
        <queriedFields>UnitPrice</queriedFields>
        <queriedFields>Quantity</queriedFields>
        <queriedFields>Sale_Type__c</queriedFields>
        <queriedFields>Revenue_Type__c</queriedFields>
        <queriedFields>Billing_Frequency__c</queriedFields>
        <queriedFields>Product_Start_Date__c</queriedFields>
        <queriedFields>Product_End_Date__c</queriedFields>
        <queriedFields>Description</queriedFields>
        <queriedFields>Unit_Name__c</queriedFields>
        <queriedFields>Proj_Rpt_Frequency__c</queriedFields>
        <queriedFields>CurrencyIsoCode</queriedFields>
    </recordLookups>
    <start>
        <locationX>316</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Agreement_Version_0</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <description>Agreement lineItem Collection</description>
        <name>AgreementlineItemCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Apttus__AgreementLineItem__c</objectType>
    </variables>
    <variables>
        <description>Agreement LineItem Instance to assign value from opp. Line Item to Agreement Line Items</description>
        <name>AgreementLineItemInstance</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Apttus__AgreementLineItem__c</objectType>
    </variables>
    <variables>
        <description>To store agreement record reference passed from record triggered flow.</description>
        <name>newRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Apttus__APTS_Agreement__c</objectType>
    </variables>
    <variables>
        <description>Collect all opportunity line items</description>
        <name>Opportunity_LineItem_Collection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
</Flow>
